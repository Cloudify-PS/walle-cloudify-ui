#######
# Types and implementation details.
#
# Virtual machine is started using Cloudify's built-in OpenStack plugin.
# Python simple HTTP server is started using Cloudify's Python web server plugin
# which can be found here: https://github.com/CloudifySource/cosmo-plugin-python-webserver
#

# cloudify.types contains Cloudify's built-in types, relationships, workflows etc...
# openstack_host_provisioner contains Cloudify's built-in OpenStack plugin definition.

imports:
    - cloudify.openstack

# Python web server plugin definition with a specification to run in an agent vm.
# Plugin will be downloaded and installed from the provided url.
plugins:
    python_webserver_installer:
        derived_from: cloudify.plugins.agent_plugin
        properties:
            url: https://github.com/CloudifySource/cosmo-plugin-python-webserver/archive/develop.zip

types:
    web_server:
        derived_from: cloudify.types.web_server
        properties:
            -   port
        interfaces:
            cloudify.interfaces.lifecycle:
                -   configure: python_webserver_installer.tasks.configure
                -   start: python_webserver_installer.tasks.start
                -   stop: python_webserver_installer.tasks.stop


# Uncomment 'server' below and fill in the place holders 
# with the proper configuration. also, make sure worker_config.key matches 
# the filename created (or used) during the bootstrap process

type_implementations:

    front_openstack_host_impl:
        type: cloudify.openstack.server
        node_ref: front_host
        properties:
            install_agent: true
            worker_config:
                user: ubuntu
                port: 22
                # example for ssh key file (see `key_name` below) 
                # this file matches the agent key configured during the bootstrap
                key: ~/.ssh/cloudify-agents-kp.pem
            server:
                name: myhost        ### HOST_NAME
                image_name: 34459   ### IMAGE_ID
                flavor_name: 101  ### FLAVOR 
                key_name: idanmo     ### KEY_PAIR_NAME
            management_network_name: 'mgmt_net'
            nova_config: {}
            neutron_config: {}

    web_network_openstack_impl:
        type: cloudify.openstack.network
        node_ref: app_network
        properties:
            network: 
               name: 'web_network'
               admin_state_up: 'True'
            neutron_config: {}
    
    web_subnet_openatack_imple:
        type: cloudify.openstack.subnet
        node_ref: app_subnet
        properties:
            subnet:
                name: 'web_subnet'
                cidr: '192.168.12.0/23'
            neutron_config: {}
        

    http_web_server_web_server_impl:
        type: web_server
        node_ref: http_web_server
