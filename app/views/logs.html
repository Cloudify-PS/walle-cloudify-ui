<div class="cosmo-layout" id="logs">

    <div class="content-header no-border">
        <div class="breadcrumbs"><ul>
            <li><span>{{'breadcrumb.logs' | translate }}</span></li>
        </ul></div>
    </div>

    <div class="content-section"  st-table="logsHits" st-pipe="updateData" >
        <div class="filters">

            <div class="filter gs-selection-button" ng-show="blueprintsList.length">
                {{'logs.filters.blueprints.title' | translate }}<br>
                <div multi:select:menu
                     class="gs-select"
                     data-multiple="true"
                     data-options="blueprintsList"
                     data-ng-model="eventsFilter.blueprints"
                     name="blueprints"
                     cfy-st-search
                     predicate="blueprint_id"
                     match="{{pluckArrayOfObjects(eventsFilter.blueprints,'value')}}"
                     data-text="{{'logs.filters.blueprints.text' | translate }}"></div>
            </div>

            <div class="filter gs-selection-button" ng-show="deploymentsList.length">
                {{'logs.filters.deployments.title' | translate }}<br>
                <div multi:select:menu
                     class="gs-select"
                     data-multiple="true"
                     data-options="deploymentsList"
                     data-ng-model="eventsFilter.deployments"
                     name="deployments"
                     cfy-st-search
                     predicate="deployment_id"
                     match="{{pluckArrayOfObjects(eventsFilter.deployments,'value')}}"
                     data-text="{{'logs.filters.deployments.text' | translate }}"></div>
            </div>

            <div class="filter gs-selection-button" ng-show="logLevelsList.length">
                {{'logs.filters.logLevels.title' | translate }}<br>
                <div multi:select:menu
                     class="gs-select"
                     data-multiple="true"
                     data-options="logLevelsList"
                     data-ng-model="eventsFilter.logLevels"
                     name="logLevels"
                     cfy-st-search
                     predicate="level"
                     match="{{pluckArrayOfObjects(eventsFilter.logLevels,'value')}}"
                     data-text="{{'logs.filters.logLevels.text' | translate }}"></div>
            </div>
            <!--timestamp Range filters-->
            <!-- TODO : add support of i18n here-->
            <!--<div class="gs-date-range-selection"-->
                 <!--cfy-st-search-->
                 <!--predicate="timestamp"-->
                 <!--gte="{{eventsFilter.timeRange.gte}}"-->
                 <!--lte="{{eventsFilter.timeRange.lte}}">-->

                <!--<div class="filter gs-selection-button">-->
                <!--Time range:<br>-->
                <!--<input class="gs-select"-->
                       <!--type="datetime"-->
                       <!--placeholder="From"-->
                       <!--date-time-->
                       <!--auto-close="true"-->
                       <!--data-ng-model="eventsFilter.timeRange.gte"/>-->
            <!--</div>-->
                <!--<div class="filter gs-selection-button">-->
                    <!--<br>-->
                    <!--<input class="gs-select"-->
                           <!--type="datetime"-->
                           <!--placeholder="To"-->
                           <!--date-time-->
                           <!--auto-close="true"-->
                           <!--data-ng-model="eventsFilter.timeRange.lte"/>-->
                <!--</div>-->
            <!--</div>-->

            <div class="actions">
                <button class="gs-btn" data-ng-click="clearFilters()" >Clear Filter</button>
            </div>
        </div>

        <div class="error" ng-if="getLogsError"><b>{{'logs.gettingLogsFailed' | translate}}</b><br/>{{getLogsError}}</div>
        <table class="gs-table eventsTable">
            <thead>
            <tr>
                <th st-sort="_source.event_type" class="icon sorting"><!-- icon --></th>
                <th st-sort="_source.timestamp" class="date sorting" >{{'logs.fields.timestamp' | translate}}</th>
                <th st-sort="_source.event_type" class="type sorting">{{ 'deployment.table.heading.eventType' | translate }}</th>
                <th st-sort="_source.level" class="node sorting">{{ 'deployment.table.heading.logLevel' | translate }}</th>
                <th st-sort="_source.context.operation" class="node sorting">{{ 'deployment.table.heading.operation' | translate }}</th>
                <th st-sort="_source.context.node_name" class="node sorting">{{ 'deployment.table.heading.node' | translate }}</th>
                <th st-sort="_source.context.node_id" class="node sorting">{{ 'deployment.table.heading.nodeId' | translate }}</th>
                <th st-sort="_source.message.text" class="task sorting">{{ 'deployment.table.heading.message' | translate }}</th>
            </tr>
            </thead>
            <tbody  ng-repeat="log in logsHits" ng-init="isOpen=false">
            <tr data-ng-click="isOpen=!isOpen">
                <td class="icon-events" ng-class="getEventIcon(log)"></td>
                <td class="date"><p>{{log._source.timestamp == undefined && '-' || log.formattedTimestamp }}</p></td>
                <td class="type"><p>{{getEventText(log._source.event_type) == undefined && '-' || getEventText(log._source.event_type)}}</p></td>
                <td class="level"><p>{{log._source.level == undefined && '-' || log._source.level | uppercase}}</p></td>
                <td class="operation"><p>{{log._source.context.operation == undefined && '-' || log._source.context.operation}}</p></td>
                <td class="node_name"><p>{{log._source.context.node_name == undefined && '-' || log._source.context.node_name}}</p></td>
                <td class="node_id"><p>{{log._source.context.node_id == undefined && '-' || log._source.context.node_id}}</p></td>
                <td class="task"><p class="large-text-overflow">{{log._source.message.text == undefined && '-' || log._source.message.text}}</p></td>
            </tr>
            <tr class="details" data-ng-show="isOpen">
                <td colspan="8">
                    <div class="message-text">
                        <span><b>{{'logs.fields.messageText' | translate}}</b><br/>{{log._source.message.text == undefined && 'N/A' || log._source.message.text}}</span>
                    </div>
                    <div class="group">
                        <span><b>{{'logs.fields.executionId' | translate}}</b> {{ log._source.context.execution_id == undefined && 'N/A' || log._source.context.execution_id }}</span>
                        <span><b>{{'logs.fields.nodeId' | translate}}</b> {{ log._source.context.node_id == undefined && 'N/A' || log._source.context.node_id }}</span>
                    </div>
                    <div class="group">
                        <span><b>{{'logs.fields.taskName' | translate}}</b> {{ log._source.context.task_name == undefined && 'N/A' || log._source.context.task_name }}</span>
                        <span><b>{{'logs.fields.plugin' | translate}}</b> {{ log._source.context.plugin == undefined && 'N/A' || log._source.context.plugin }}</span>
                        <span><b>{{'logs.fields.operation' | translate}}</b> {{ log._source.context.operation == undefined && 'N/A' || log._source.context.operation }}</span>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="pagination" st-pagination="" st-items-by-page="itemsPerPage" st-displayed-pages="9"></div>
        <div class="emptyTable" data-ng-hide="logsHits.length">{{'logs.noLogs' | translate}}</div>
        </div>
    </div>
