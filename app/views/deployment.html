<div class="cosmo-layout" id="deployment">

    <!-- Side Panel - START -->
    <div class="properties-panel right-panel" ng-hide="!showProperties">
        <div class="title">
            {{showProperties.general.name}} Details
            <i ng-click="hideProperties()" class="fa fa-times-circle right"></i>
        </div>
        <div class="content">
            <div class="buttons-group" checkbox-toggle value="section">
                <button type="button" class="btn btn-default" value="general">{{ 'plans.general' | i18n }}</button>
            </div>
            <div ng-switch="section" class="content-section">
                <pre ng-switch-default="general">{{showProperties.general | yaml:'No general information' }} </pre>
            </div>
        </div>
    </div>
    <!-- Side Panel - END -->


    <div events-widget id="plans-index-events-widget" events="{{events}}" ng-show="section != 'events'"></div>

    <div id="deployment-header">
        <div class="header-right">
            <div app-status-widget id="appStatus" ng-model="appStatus"></div>
        </div>
        <div class="header-left">
            <div class="content-header">
                <div class="breadcrumbs"><ul id="deployments" breadcrumbs></ul></div>
            </div>

            <!-- Settings - START -->
            <div class="buttons-group no-embed" checkbox-toggle value="section">
                <button type="button" class="btn btn-default" value="topology">Topology</button>
                <button type="button" class="btn btn-default" value="network">Network</button>
                <button type="button" class="btn btn-default" value="events">Events</button>
            </div>
            <div settings-toggles id="settings-button" class="no-embed" toggles="toggleBar"></div>
            <!-- Settings - END -->

            <div ng-switch="section" class="content-section">
                <!-- Topology Tab - START -->
                <div class="bpContainer" ng-switch-default="topology" blueprint:resize data-ng-class="{
                disableCompute: !toggleBar.compute,
                disableMiddleware: !toggleBar.middleware,
                disableModules: !toggleBar.modules,
                disableConnections: !toggleBar.connections
                }">
                    <div data-type="compute" data-ng-repeat="rootNode in map" class="box" blueprint:coordinate="rootNode.id">
                        <div class="hoverup">
                            <div class="buttons no-embed">
                                <ul>
                                    <li data-ng-click="viewNode(rootNode)" class="topology-glyph node-details"></li>
                                </ul>
                            </div>
                        </div>
                        <div pie:progress="deployments[indexNodes[rootNode.id].nodeId].process" class="piProgress" size="51">
                            <div class="circle">
                                <i class="icon topology-glyph host">
                                    <div class="badge" data-ng-class="getBadgeStatus(indexNodes[rootNode.id].nodeId)">
                                        {{ deployments[indexNodes[rootNode.id].nodeId].completed }}/{{ deployments[indexNodes[rootNode.id].nodeId].instances }}
                                    </div>
                                </i>
                            </div>
                        </div>
                        <div class="head">{{ indexNodes[rootNode.id].name }}</div>
                        <div class="holder">
                            <!-- Middleware::start -->
                            <div data-type="middleware" data-ng-repeat="subNode in rootNode.children" class="box" blueprint:coordinate="subNode.id">
                                <div class="hoverup">
                                    <div class="buttons no-embed">
                                        <ul>
                                            <li data-ng-click="viewNode(subNode)" class="topology-glyph node-details"></li>
                                        </ul>
                                    </div>
                                </div>
                                <div pie:progress="deployments[indexNodes[subNode.id].nodeId].process" class="piProgress" size="51">
                                    <div class="circle">
                                        <i class="icon topology-glyph app-server">
                                            <div class="badge" data-ng-class="getBadgeStatus(indexNodes[subNode.id].nodeId)">
                                                {{ deployments[indexNodes[subNode.id].nodeId].completed }}/{{ deployments[indexNodes[subNode.id].nodeId].instances }}
                                            </div>
                                        </i>
                                    </div>
                                </div>
                                <div class="head">{{ indexNodes[subNode.id].name }}</div>
                                <div class="holder">
                                    <!-- Module::start -->
                                    <div data-type="modules" data-ng-repeat="appNode in subNode.children" class="app">
                                        <div class="hoverup">
                                            <div class="buttons no-embed">
                                                <ul>
                                                    <li data-ng-click="viewNode(appNode)" class="topology-glyph node-details"></li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div pie:progress="deployments[indexNodes[appNode.id].nodeId].process" class="piProgress" size="51">
                                            <div class="circle" blueprint:coordinate="appNode.id">
                                                <i class="icon topology-glyph app-module">
                                                    <div class="badge" data-ng-class="getBadgeStatus(indexNodes[appNode.id].nodeId)">
                                                        {{ deployments[indexNodes[appNode.id].nodeId].completed }}/{{ deployments[indexNodes[appNode.id].nodeId].instances }}
                                                    </div>
                                                </i>
                                            </div>
                                        </div>
                                        <p>{{ indexNodes[appNode.id].name }}</p>
                                    </div>
                                    <!-- Module::end -->
                                </div>
                            </div>
                            <!-- Middleware::end -->
                        </div>
                    </div>
                    <div class="coordinates" blueprint:arrows="coordinates"></div>
                </div>
                <!-- Topology Tab - END -->
                <!-- Network Tab - START -->
                <div ng-switch-when="network">{{ 'deployment.title.network' | i18n }}</div>
                <!-- Network Tab - END -->
                <!-- Events Tab - START -->
                <div ng-switch-when="events">
                    <div class="filters">
                        Workflow: <div multi:select:menu
                             data-options="workflowsList"
                             data-ng-model="eventsFilter.workflow"
                             data-init="[null]"
                             data-text="Choose Workflow"
                             data-onchange="filterEventsByWorkflow(filter)"></div>
                        Event Type: <div multi:select:menu
                             data-options="eventTypeList"
                             data-ng-model="eventsFilter.type"
                             data-init="[null]"
                             data-text="Choose Type"
                             data-onchange="filterEventsByType(filter)"></div>
                        <div class="search">
                            <input type="text" data-ng-model="eventsFilter.nodes" placeholder="Search Node"><button data-ng-click="eventFindNodes()">Find</button>
                        </div>
                        <div class="loading" data-ng-show="filterLoading"></div>
                    </div>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th class="icon"><!-- icon --></th>
                                <th class="date sorting" data-ng-click="sortEvents('timestamp')" data-ng-class="isSorted('timestamp')">Timestamp</th>
                                <th class="type sorting" data-ng-click="sortEvents('eventType')" data-ng-class="isSorted('eventType')">{{ 'deployment.table.heading.eventType' | i18n }}</th>
                                <th class="node sorting" data-ng-click="sortEvents('node')" data-ng-class="isSorted('node')">{{ 'deployment.table.heading.node' | i18n }}</th>
                                <th class="task sorting" data-ng-click="sortEvents('task')" data-ng-class="isSorted('task')">{{ 'deployment.table.heading.task' | i18n }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="event in eventHits">
                                <td class="icon" ng-class="getEventIcon(event._source.event_type)"></td>
                                <td class="date">{{event._source.timestamp == undefined && 'N/A' || event._source.timestamp | dateFormat: 'yyyy-MM-dd HH:mm:ss'}}</td>
                                <td class="type">{{getEventText(event._source.event_type) == undefined && 'N/A' || getEventText(event._source.event_type)}}</td>
                                <td class="node">{{event._source.context.node_name == undefined && 'N/A' || event._source.context.node_name}}</td>
                                <td class="task">{{event._source.message.text == undefined && 'N/A' || event._source.message.text}}</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="emptyTable" data-ng-hide="eventHits.length">There is no events at this moment...</div>
                </div>
                <!-- Events Tab - END -->
            </div>
        </div>
    </div>
</div>