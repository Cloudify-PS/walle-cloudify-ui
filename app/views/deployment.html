<div class="cosmo-layout" id="deployment">

    <!-- Side Panel - START -->
    <div class="properties-panel right-panel" ng-hide="!showProperties">
        <div class="title">
            {{showProperties.general.name}} Details
            <i ng-click="hideProperties()" class="fa fa-times-circle right close-properties-button"></i>
        </div>

        <div class="content">

            <select ng-model="selectedNode" ng-change="nodeSelected(selectedNode)" ng-options="node.id for node in selectNodesArr">
                <option value="">{{ 'plans.all' | i18n }}</option>
            </select>
            <div class="selectbox-arrow"></div>

            <div class="buttons-group no-embed" checkbox-toggle value="propSection" ng-show="selectedNode != null">
                <button ng-repeat="(key, value) in showProperties" type="button" class="btn btn-default" ng-class="{active: key == propSection}" value="{{key}}">{{ 'plans.' + key | i18n }}</button>
            </div>

            <div ng-switch="section" class="content-section">

                <div ng-switch="propSection" class="content-section prop-section">
                    <div ng-switch-default="general">
                        <table>
                            <tr>
                                <td>{{ 'plans.details.key' | i18n }}</td>
                                <td>{{ 'plans.details.value' | i18n }}</td>
                            </tr>
                            <tr ng-repeat="(key, value) in showProperties.general">
                                <td>{{key}}</td><td>{{value}}</td>
                            </tr>
                        </table>
                    </div>
                    <div ng-switch-when="properties">
                        <table>
                            <tr>
                                <td>{{ 'plans.details.key' | i18n }}</td>
                                <td>{{ 'plans.details.value' | i18n }}</td>
                            </tr>
                            <tr ng-repeat="(key, value) in showProperties.properties">
                                <td>{{key}}</td><td>{{value}}</td>
                            </tr>
                        </table>
                    </div>
                    <div ng-switch-when="relationships">
                        <div class="no-properties" ng-show="showProperties.relationships.length == undefined">{{ 'plans.details.noRelationships' | i18n }}</div>

                        <table class="relationships-table" ng-show="showProperties.relationships.length != undefined">
                            <tr>
                                <td>{{ 'plans.details.target' | i18n }}</td>
                                <td>{{ 'plans.details.type' | i18n }}</td>
                                <td>{{ 'plans.details.source' | i18n }}</td>
                            </tr>
                            <tr ng-repeat="relationship in showProperties.relationships">
                                <td colspan="3">
                                    <table class="interfaces-table">
                                        <tr ng-click="showRelationship(relationship)">
                                            <td><div class="relationship-arrow right" ng-class="{'down': selectedRelationship == relationship, 'right': selectedRelationship != relationship}"></div>{{relationship.target_id}}</td>
                                            <td>{{relationship.type}}</td>
                                            <td>{{showProperties.general.name}}</td>
                                        </tr>
                                        <tr ng-show="selectedRelationship.target_id == relationship.target_id && selectedRelationship.type == relationship.type">
                                            <td colspan="3">

                                                <table>
                                                    <tr>
                                                        <td>{{ 'plans.details.interface' | i18n }}</td>
                                                        <td>{{ 'plans.details.methods' | i18n }}</td>
                                                    </tr>
                                                    <tr ng-repeat="(key, value) in relationship.target_interfaces">
                                                        <td>{{key}}</td>
                                                        <td>
                                                            <ul ng-repeat="val in value">
                                                                <li>{{val}}</li>
                                                            </ul>
                                                        </td>
                                                    </tr>
                                                </table>

                                            </td>
                                        </tr>
                                    </table>

                                </td>
                            </tr>
                        </table>

                    </div>

                    <pre ng-switch-when="interfaces">{{showProperties.interfaces | yaml:'No interfaces to display' }} </pre>

                    <div ng-switch-when="overview">
                        <div ng-repeat="node in selectNodesArr">
                            <div class="overview-node-name">{{node.id}}</div>
                            <table class="overview-data">
                                <tr>
                                    <td>{{ 'plans.details.key' | i18n }}</td>
                                    <td>{{ 'plans.details.value' | i18n }}</td>
                                </tr>
                                <tr ng-repeat="(key, value) in getNodeStateData(node.id)">
                                    <td>{{key}}</td><td>{{value}}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Side Panel - END -->

    <div events-widget id="plans-index-events-widget" data-ng-model="eventHits" ng-show="section != 'events'"></div>

    <div app-status-widget id="appStatus" ng-model="deployments['*'].process" status="{{ deployments['*'].state }}"></div>

    <div id="deployment-header">
        <div class="header-left">
            <div class="content-header">
                <div class="breadcrumbs"><ul id="deployments" breadcrumbs></ul></div>
            </div>

            <!-- Settings - START -->
            <div class="buttons-group no-embed" checkbox-toggle value="section">
                <button type="button" class="btn btn-default" value="topology">Topology</button>
                <button type="button" class="btn btn-default" value="network" data-ng-show="networks.networks.length">Network</button>
                <button type="button" class="btn btn-default" value="nodes">Nodes</button>
                <button type="button" class="btn btn-default" value="events">Events</button>
                <!--<button type="button" class="btn btn-default" value="monitoring">Monitoring</button>-->
            </div>
            <div settings-toggles id="settings-button" class="no-embed" toggles="toggleBar"></div>

            <div class="actions">
                <div class="gs-selection-button" ng-show="!deploymentInProgress">
                    <div multi:select:menu
                         class="gs-select"
                         data-options="workflowsList"
                         data-ng-model="selectedWorkflow.data"
                         data-text="Select workflow"></div>
                </div>
                <div class="executingWorkflow" ng-show="deploymentInProgress">
                    {{executedData.workflow_id}}
                    <div class="deploymentExecute" dots-loader speed="50" ng-show="deploymentInProgress"></div>
                </div>
                <i class="deployment-play" ng-class="{play: isExecuteEnabled(), disabled: !isExecuteEnabled()}" ng-click="toggleConfirmationDialog(deployment, 'execute')" ng-show="!deploymentInProgress"></i>

                <i class="deployment-pause pause" ng-show="deploymentInProgress" ng-click="toggleConfirmationDialog(deployment, 'cancel')"></i>
            </div>

            <!-- Settings - END -->

            <div ng-switch="section" class="content-section">
                <!-- Topology Tab - START -->
                <div class="bpContainer" ng-switch-default="topology" blueprint:resize data-ng-class="{
                disableCompute: !toggleBar.compute,
                disableMiddleware: !toggleBar.middleware,
                disableModules: !toggleBar.modules,
                disableConnections: !toggleBar.connections
                }">
                    <div bp-topology-nodes map="nodesTree" selected="viewNode(getNodeById(node_id))"></div>
                    <div class="coordinates" blueprint:arrows="coordinates" arrow="true" color="#7A7A7A"></div>
                </div>
                <!-- Topology Tab - END -->
                <!-- Network Tab - START -->
                <!-- Network Topology - START -->
                <div class="networksContainer" ng-switch-when="network">
                    <div bp:networks class="relations"></div>

                    <!-- External networks -->
                    <div data-ng-repeat="network in networks.external" class="network">
                        <div class="line">
                            <div class="name">{{ network.name }}</div>
                            <div class="subnet" bp:network:coordinate ng-model="network">
                                <p>{{ network.name }}</p>
                                <p class="cidr">{{ network.type }}</p>
                            </div>
                        </div>
                        <div class="devices">
                            <div data-ng-repeat="device in network.devices" class="device">
                                <div data-ng-class="{'true': 'portarea'}[device.ports.length > 0]">
                                    <div class="inner">
                                        <div class="buttons no-embed">
                                            <ul>
                                                <li data-ng-click="viewNode(device)" class="topology-glyph node-details"></li>
                                            </ul>
                                        </div>
                                        <i class="topology-glyph {{ device.icon }}" bp:network:coordinate ng-model="device"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div data-ng-repeat="network in networks.networks" class="network">
                        <div class="line">
                            <div class="name">{{ network.name }}</div>
                            <div data-ng-repeat="subnet in network.subnets" class="subnet" bp:network:coordinate ng-model="subnet">
                                <p>{{ subnet.name }}</p>
                                <div class="badge network-badge" data-ng-class="getBadgeStatus(subnet.state.status)">
                                    {{ subnet.state.completed }}/{{ subnet.state.total }}
                                </div>
                                <p class="cidr">{{ subnet.cidr }}</p>
                            </div>
                        </div>
                        <div class="devices">
                            <div data-ng-repeat="device in network.devices" class="device">
                                <div data-ng-class="{'true': 'portarea'}[device.ports.length > 0]">
                                    <div class="inner">
                                        <div class="buttons no-embed">
                                            <ul>
                                            <li data-ng-click="viewNode(device)" class="topology-glyph node-details"></li>
                                        </ul>
                                        </div>
                                        <i class="topology-glyph {{ device.icon }}" bp:network:coordinate ng-model="device"></i>
                                    </div>
                                    <div class="ports" data-ng-repeat="port in device.ports">
                                        <div class="buttons no-embed">
                                            <ul>
                                                <li data-ng-click="viewNode(getNodeById(device.id))" class="topology-glyph node-details"></li>
                                            </ul>
                                        </div>
                                        <i class="topology-glyph {{ port.icon }}" bp:network:coordinate ng-model="port"></i>
                                    </div>
                                    <div class="badge">
                                        {{ device.state.completed }}/{{ device.state.total }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Network Topology - END -->
                <!-- Network Tab - END -->
                <!-- Nodes - START -->
                <div ng-switch-when="nodes">
                    <table class="table">
                        <thead>
                        <tr>
                            <th></th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Number of instances</th>
                            <th>Contained in</th>
                            <th>Connected to</th>
                            <th><!--Actions--></th>
                        </tr>
                        </thead>
                        <tbody data-ng-repeat="row in dataTable">
                        <tr>
                            <td><i class="topology-glyph {{ row.class }}"></i></td>
                            <td>{{ row.name }}</td>
                            <td>{{ row.type }}</td>
                            <td>{{ row.instances.deploy }}</td>
                            <td>
                                <span data-ng-if="getRelationshipByType(row, 'contained').length > 0" data-ng-repeat="container in getRelationshipByType(row, 'contained')">{{ container.name }}</span>
                                <span data-ng-if="getRelationshipByType(row, 'contained').length == 0">--</span>
                            </td>
                            <td>
                                <span data-ng-if="getRelationshipByType(row, 'connected').length > 0" data-ng-repeat="connection in getRelationshipByType(row, 'connected')">{{ connection.name }}</span>
                                <span data-ng-if="getRelationshipByType(row, 'connected').length == 0">--</span>
                            </td>
                            <td>
                                <ul>
                                    <li data-ng-click="viewNode(getNodeById(row.id))" class="topology-glyph node-details"></li>
                                </ul>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Nodes - END -->
                <!-- Events Tab - START -->
                <div ng-switch-when="events">
                    <div class="filters">
                        <span>
                            Workflow: <div multi:select:menu
                                 data-options="workflowsList"
                                 data-ng-model="eventsFilter.workflow"
                                 data-init="[null]"
                                 data-text="Choose Workflow"
                                 data-onchange="filterEventsByWorkflow(filter)"></div>
                        </span>
                        <span>
                            Event Type: <div multi:select:menu
                                 data-options="eventTypeList"
                                 data-ng-model="eventsFilter.type"
                                 data-init="[null]"
                                 data-text="Choose Type"
                                 data-onchange="filterEventsByType(filter)"></div>
                        </span>
                        <span>
                            <div class="search">
                                <input type="text" name="findNode" ng-enter="eventFindNodes()" data-ng-model="eventsFilter.nodes" placeholder="Search Node"><button data-ng-click="eventFindNodes()">Find</button>
                                <span class="close" data-ng-click="clearFindNode()" data-ng-show="eventsFilter.nodes.length">x</span>
                            </div>
                        </span>
                        <span>
                            <button class="gs-btn" data-ng-click="viewAllLogs()">All logs</button>
                        </span>
                        <div class="loading" data-ng-show="filterLoading"></div>
                    </div>

                    <div class="newEvents" data-ng-show="newEvents>0">
                        <p data-ng-click="scrollToTop()">{{ newEvents }} new events</p>
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                <th class="icon"><!-- icon --></th>
                                <th class="date sorting" data-ng-click="sortEvents('timestamp')" data-ng-class="isSorted('timestamp')">Timestamp</th>
                                <th class="type sorting" data-ng-click="sortEvents('eventType')" data-ng-class="isSorted('eventType')">{{ 'deployment.table.heading.eventType' | i18n }}</th>
                                <th class="node sorting" data-ng-click="sortEvents('node')" data-ng-class="isSorted('node')">{{ 'deployment.table.heading.node' | i18n }}</th>
                                <th class="task sorting" data-ng-click="sortEvents('task')" data-ng-class="isSorted('task')">{{ 'deployment.table.heading.task' | i18n }}</th>
                                <th class="action"><!-- Actions --></th>
                            </tr>
                        </thead>
                        <tbody class="animate-repeat" ng-repeat="event in eventHits" ng-init="isOpen=false">
                            <tr>
                                <td data-ng-click="isOpen=!isOpen" class="icon cliclable" ng-class="getEventIcon(event._source.event_type)"></td>
                                <td data-ng-click="isOpen=!isOpen" class="date cliclable">{{event._source.timestamp == undefined && 'N/A' || event._source.timestamp}}</td>
                                <td data-ng-click="isOpen=!isOpen" class="type cliclable">{{getEventText(event._source.event_type) == undefined && 'N/A' || getEventText(event._source.event_type)}}</td>
                                <td data-ng-click="isOpen=!isOpen" class="node cliclable">{{event._source.context.node_name == undefined && 'N/A' || event._source.context.node_name}}</td>
                                <td data-ng-click="isOpen=!isOpen" class="task cliclable">{{event._source.message.text == undefined && 'N/A' || event._source.message.text}}</td>
                                <td class="action"><button class="gs-btn" data-ng-click="viewLogsByEvent(event)">Logs</button></td>
                            </tr>
                            <tr class="details" data-ng-show="isOpen">
                                <td colspan="6">
                                    <div class="group">
                                        <span><b>Execution ID:</b> {{ event._source.context.execution_id == undefined && 'N/A' || event._source.context.execution_id }}</span>
                                        <span><b>Node ID:</b> {{ event._source.context.node_id == undefined && 'N/A' || event._source.context.node_id }}</span>
                                    </div>
                                    <div class="group">
                                        <span><b>Task Name:</b> {{ event._source.context.task_name == undefined && 'N/A' || event._source.context.task_name }}</span>
                                        <span><b>Plugin:</b> {{ event._source.context.plugin == undefined && 'N/A' || event._source.context.plugin }}</span>
                                        <span><b>Operation:</b> {{ event._source.context.operation == undefined && 'N/A' || event._source.context.operation }}</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="emptyTable" data-ng-hide="eventHits.length">There are no events at this moment...</div>
                </div>
                <!-- Events Tab - END -->
                <div ng-switch-when="monitoring">
                    <div class="monitor" graphs:pager>
                        <div class="navigate">
                            Showing 4 graphs
                            <div class="arrowBtn left" data-ng-click="scrollLeft()"><i class="fa fa-chevron-left"></i></div>
                            <div class="arrowBtn right" data-ng-click="scrollRight()"><i class="fa fa-chevron-right"></i></div>
                        </div>
                        <div class="pagesFrame" ng-style="{width: pagerWidth}">
                            <div class="pages" ng-style="{width: pagerLength * pagerWidth + 100}">
                                <div class="page" ng-style="{width: pagerWidth}" data-ng-repeat="page in graphPages">
                                    <div class="chart" ng-repeat="graph in graphs | limitRange: page.from : page.to " bind-graph="graph" on-finish-render="fireResizeGraph"></div><!--
 Fix for break-line margin space --><div class="chart newChart" data-ng-show="graphs.length < page.to">
                                        <form novalidate class="simple-form">
                                            <h3>Add New Chart</h3>
                                            <hr />
                                            <label>
                                                Name <br>
                                                <input type="text" ng-model="newgraph.name">
                                            </label>
                                            <label>
                                                Type <br>
                                                <select data-ng-model="newgraph.type">
                                                    <option value="line">Line Chart</option>
                                                    <option value="bar">Bar Chart</option>
                                                </select>
                                                <select data-ng-model="newgraph.isArea" data-ng-show="newgraph.type == 'line'">
                                                    <option value="false">Regular</option>
                                                    <option value="true">Area</option>
                                                </select>
                                            </label>
                                            <label>
                                                Query <br><small>(Example: select value from cpu limit 100)</small><br>
                                                <textarea cols="60" rows="4" data-ng-model="newgraph.query"></textarea>
                                            </label>
                                            <br>
                                            <button class="gs-btn" data-ng-click="addMonitorChart()">Add Monitor Chart</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="deployment-progress-panel" ng-include="'views/deploymentProgressPanel.html'" ng-show="showProgressPanel"></div>

    <div ng-show="isConfirmationDialogVisible">
        <div class="dialogBoxBg"></div>
        <div id="confirmationDialogContainer" class="dialogBox">
            <div class="dialogTitle">
                <label>{{ 'deployments.confirmationPopup.title' | i18n }}</label>
            </div>
            <div class="dialogDescription" ng-show="confirmationType == 'execute'">{{ 'deployments.confirmationPopup.descriptionExecute' | i18n }} {{selectedWorkflow.data.value}}?</div>
            <div class="dialogDescription" ng-show="confirmationType == 'cancel'">{{ 'deployments.confirmationPopup.descriptionCancel' | i18n }} {{executedData.workflow_id}}?</div>
            <div class="buttonsContainer confirmationButtons">
                <button id="cancelBtn" class="dialogButton" ng-click="toggleConfirmationDialog()">{{ 'deployments.confirmationPopup.cancelBtn' | i18n }}</button>
                <button id="confirmBtn" class="dialogButton" ng-click="confirmConfirmationDialog(selectedWorkflow)">{{ 'deployments.confirmationPopup.confirmBtn' | i18n }}</button>
            </div>
        </div>
    </div>
</div>
